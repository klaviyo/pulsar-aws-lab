{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Pulsar Cluster Configuration",
  "description": "Schema for Apache Pulsar cluster settings",
  "type": "object",
  "required": ["pulsar_version", "zookeeper", "bookkeeper", "broker"],
  "properties": {
    "pulsar_version": {
      "type": "string",
      "pattern": "^[0-9]+\\.[0-9]+\\.[0-9]+$",
      "description": "Pulsar version to install (e.g., 3.0.0)"
    },
    "cluster_name": {
      "type": "string",
      "default": "pulsar-aws-lab",
      "description": "Pulsar cluster name"
    },
    "zookeeper": {
      "type": "object",
      "properties": {
        "heap_size": {
          "type": "string",
          "pattern": "^[0-9]+[MG]$",
          "default": "512M",
          "description": "JVM heap size (e.g., 512M, 1G)"
        },
        "max_client_connections": {
          "type": "integer",
          "default": 60,
          "description": "Maximum client connections per ZooKeeper"
        },
        "tick_time": {
          "type": "integer",
          "default": 2000,
          "description": "ZooKeeper tick time in milliseconds"
        },
        "init_limit": {
          "type": "integer",
          "default": 10,
          "description": "ZooKeeper init limit"
        },
        "sync_limit": {
          "type": "integer",
          "default": 5,
          "description": "ZooKeeper sync limit"
        },
        "data_dir": {
          "type": "string",
          "default": "/var/lib/zookeeper",
          "description": "ZooKeeper data directory"
        }
      }
    },
    "bookkeeper": {
      "type": "object",
      "properties": {
        "heap_size": {
          "type": "string",
          "pattern": "^[0-9]+[MG]$",
          "default": "1G",
          "description": "JVM heap size"
        },
        "direct_memory_size": {
          "type": "string",
          "pattern": "^[0-9]+[MG]$",
          "default": "1G",
          "description": "JVM direct memory size"
        },
        "journal_dir": {
          "type": "string",
          "default": "/var/lib/bookkeeper/journal",
          "description": "Journal directory (should be on fast storage)"
        },
        "ledger_dirs": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "default": ["/var/lib/bookkeeper/ledgers"],
          "description": "Ledger storage directories"
        },
        "journal_max_size_mb": {
          "type": "integer",
          "default": 2048,
          "description": "Maximum journal file size in MB"
        },
        "journal_sync_data": {
          "type": "boolean",
          "default": true,
          "description": "Sync journal writes to disk"
        },
        "ledger_storage_class": {
          "type": "string",
          "enum": ["org.apache.bookkeeper.bookie.storage.ldb.DbLedgerStorage", "org.apache.bookkeeper.bookie.InterleavedLedgerStorage"],
          "default": "org.apache.bookkeeper.bookie.storage.ldb.DbLedgerStorage",
          "description": "Ledger storage implementation"
        },
        "num_journal_callback_threads": {
          "type": "integer",
          "default": 8,
          "description": "Number of journal callback threads"
        },
        "num_add_worker_threads": {
          "type": "integer",
          "default": 8,
          "description": "Number of add worker threads"
        }
      }
    },
    "broker": {
      "type": "object",
      "properties": {
        "heap_size": {
          "type": "string",
          "pattern": "^[0-9]+[MG]$",
          "default": "1G",
          "description": "JVM heap size"
        },
        "direct_memory_size": {
          "type": "string",
          "pattern": "^[0-9]+[MG]$",
          "default": "1G",
          "description": "JVM direct memory size"
        },
        "managed_ledger_cache_size_mb": {
          "type": "integer",
          "default": 512,
          "description": "Managed ledger cache size in MB"
        },
        "managed_ledger_default_ensemble_size": {
          "type": "integer",
          "default": 3,
          "description": "Default ensemble size for new topics"
        },
        "managed_ledger_default_write_quorum": {
          "type": "integer",
          "default": 3,
          "description": "Default write quorum for new topics"
        },
        "managed_ledger_default_ack_quorum": {
          "type": "integer",
          "default": 2,
          "description": "Default ack quorum for new topics"
        },
        "default_retention_time_minutes": {
          "type": "integer",
          "default": 0,
          "description": "Default retention time (0 = infinite)"
        },
        "default_retention_size_mb": {
          "type": "integer",
          "default": 0,
          "description": "Default retention size (0 = infinite)"
        },
        "max_unacked_messages_per_consumer": {
          "type": "integer",
          "default": 50000,
          "description": "Maximum unacked messages per consumer"
        },
        "max_unacked_messages_per_subscription": {
          "type": "integer",
          "default": 200000,
          "description": "Maximum unacked messages per subscription"
        },
        "dispatch_throttling_rate_per_topic_in_msg": {
          "type": "integer",
          "default": 0,
          "description": "Dispatch throttling rate per topic (0 = disabled)"
        },
        "dispatch_throttling_rate_per_topic_in_byte": {
          "type": "integer",
          "default": 0,
          "description": "Dispatch throttling rate per topic in bytes (0 = disabled)"
        }
      }
    },
    "functions": {
      "type": "object",
      "properties": {
        "enabled": {
          "type": "boolean",
          "default": false,
          "description": "Enable Pulsar Functions"
        },
        "worker_heap_size": {
          "type": "string",
          "pattern": "^[0-9]+[MG]$",
          "default": "512M",
          "description": "Functions worker heap size"
        }
      }
    }
  }
}
