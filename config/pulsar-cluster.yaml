# Pulsar Cluster Configuration
# Optimized for small instance types with basic functionality

pulsar_version: "3.0.0"
cluster_name: "pulsar-aws-lab"

zookeeper:
  heap_size: "512M"  # Conservative for t3.micro (1GB total RAM)
  max_client_connections: 60
  tick_time: 2000
  init_limit: 10
  sync_limit: 5
  data_dir: "/var/lib/zookeeper"

bookkeeper:
  # Memory settings optimized for t3.small (2GB RAM)
  heap_size: "768M"
  direct_memory_size: "512M"

  # Storage paths
  journal_dir: "/mnt/bookkeeper/journal"  # Fast storage for WAL
  ledger_dirs:
    - "/mnt/bookkeeper/ledgers"

  # Journal settings
  journal_max_size_mb: 2048
  journal_sync_data: true  # Durability over performance

  # Storage implementation (DbLedgerStorage recommended for better performance)
  ledger_storage_class: "org.apache.bookkeeper.bookie.storage.ldb.DbLedgerStorage"

  # Thread pools (conservative for small instances)
  num_journal_callback_threads: 4
  num_add_worker_threads: 4

broker:
  # Memory settings optimized for t3.small (2GB RAM)
  heap_size: "1G"
  direct_memory_size: "512M"

  # Managed ledger cache (impacts memory usage)
  managed_ledger_cache_size_mb: 256

  # Replication settings (ensemble = write quorum = bookkeeper count)
  managed_ledger_default_ensemble_size: 3
  managed_ledger_default_write_quorum: 3
  managed_ledger_default_ack_quorum: 2

  # Retention policies (0 = infinite, adjust based on storage constraints)
  default_retention_time_minutes: 0
  default_retention_size_mb: 0

  # Flow control
  max_unacked_messages_per_consumer: 50000
  max_unacked_messages_per_subscription: 200000

  # Throttling (0 = disabled, enable if needed for testing)
  dispatch_throttling_rate_per_topic_in_msg: 0
  dispatch_throttling_rate_per_topic_in_byte: 0

functions:
  enabled: false  # Disable to save resources
  worker_heap_size: "512M"
