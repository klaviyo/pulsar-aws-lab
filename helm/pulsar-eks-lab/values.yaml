#
# Licensed to the Apache Software Foundation (ASF) under one
# or more contributor license agreements.  See the NOTICE file
# distributed with this work for additional information
# regarding copyright ownership.  The ASF licenses this file
# to you under the Apache License, Version 2.0 (the
# "License"); you may not use this file except in compliance
# with the License.  You may obtain a copy of the License at
#
#   http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing,
# software distributed under the License is distributed on an
# "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
# KIND, either express or implied.  See the License for the
# specific language governing permissions and limitations
# under the License.
#

# EKS-optimized values for load testing
# Increased resources for realistic testing scenarios

# OpenMessaging Benchmark Configuration
omb:
  enabled: true
  image:
    repository: pulsar-omb
    tag: latest
    pullPolicy: IfNotPresent

  # Producer configuration
  producer:
    enabled: true
    replicaCount: 1
    resources:
      requests:
        memory: "1Gi"
        cpu: "500m"
      limits:
        memory: "2Gi"
        cpu: "1000m"

  # Consumer configuration
  consumer:
    enabled: true
    replicaCount: 1
    resources:
      requests:
        memory: "1Gi"
        cpu: "500m"
      limits:
        memory: "2Gi"
        cpu: "1000m"

pulsar:
  # Use persistent volumes in EKS
  volumes:
    persistence: true

  # Enable anti-affinity for production-like deployment
  affinity:
    anti_affinity: true

  # Enable auto recovery
  components:
    autorecovery: true
    pulsar_manager: true

  zookeeper:
    replicaCount: 3
    resources:
      requests:
        memory: "1Gi"
        cpu: "500m"
      limits:
        memory: "2Gi"
        cpu: "1000m"
    podMonitor:
      enabled: true
      interval: 30s

  bookkeeper:
    replicaCount: 3
    resources:
      requests:
        memory: "2Gi"
        cpu: "1000m"
      limits:
        memory: "4Gi"
        cpu: "2000m"
    configData:
      dbStorage_writeCacheMaxSizeMb: "1024"
      dbStorage_readAheadCacheMaxSizeMb: "512"
      dbStorage_rocksDB_writeBufferSizeMB: "256"
      dbStorage_rocksDB_blockCacheSize: "268435456"
      PULSAR_MEM: "-Xms1g -Xmx2g -XX:MaxDirectMemorySize=2g"
    podMonitor:
      enabled: true
      interval: 30s

  broker:
    replicaCount: 3
    resources:
      requests:
        memory: "2Gi"
        cpu: "1000m"
      limits:
        memory: "4Gi"
        cpu: "2000m"
    configData:
      autoSkipNonRecoverableData: "true"
      managedLedgerDefaultEnsembleSize: "3"
      managedLedgerDefaultWriteQuorum: "3"
      managedLedgerDefaultAckQuorum: "2"
      maxPublishRatePerTopicInMessages: "1000000"
      maxPublishRatePerTopicInBytes: "1073741824"
      maxMessagePublishBufferSizeInMB: "1024"
      dispatchThrottlingRatePerTopicInMsg: "1000000"
    podMonitor:
      enabled: true
      interval: 30s

  proxy:
    replicaCount: 2
    resources:
      requests:
        memory: "512Mi"
        cpu: "500m"
      limits:
        memory: "1Gi"
        cpu: "1000m"
    podMonitor:
      enabled: true
      interval: 30s

  # Enable monitoring stack with Grafana dashboards
  kube-prometheus-stack:
    enabled: true
    prometheus:
      enabled: true
      prometheusSpec:
        retention: 24h
        scrapeInterval: 30s
        evaluationInterval: 30s
        storageSpec:
          volumeClaimTemplate:
            spec:
              accessModes: ["ReadWriteOnce"]
              resources:
                requests:
                  storage: 50Gi
    grafana:
      enabled: true
      adminPassword: admin
      sidecar:
        dashboards:
          enabled: true
          label: grafana_dashboard
          labelValue: "1"
          searchNamespace: ALL
      persistence:
        enabled: true
        size: 10Gi
